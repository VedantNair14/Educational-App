<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Education Demo | Online Video Courses For Students </title>
    <meta name="description" content="Unlock your potential with high-quality, free video courses on Python programming, data science, and more. Start learning today.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <header class="main-header">
        <div class="container">
            <nav class="navbar">
                <div class="navbar-brand">
                    <svg class="logo-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
                    <span>Educational Zone </span>
                </div>
                
                <!-- Hamburger Menu Button for Mobile -->
                <button class="menu-toggle" onclick="toggleMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>

                <div class="navbar-links">
                    <a href="#" class="nav-link">Courses</a>
                    <a href="#" class="nav-link">My Learning</a>
                    
                    <!-- NEW DROPDOWN STRUCTURE -->
                    <div class="dropdown">
                        <button onclick="toggleDropdown()" class="dropdown-btn">
                            Language
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                            </svg>
                        </button>
                        <div id="language-dropdown" class="dropdown-content">
                            <a href="/">All</a>
                            {% for lang_name in languages %}
                                <a href="/?lang={{ lang_name }}">{{ lang_name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                    <!-- END OF NEW DROPDOWN -->

                    {% if user %}
                        {% if user.role == 'admin' %}
                        <a href="/upload" class="nav-link">Upload</a>
                        {% endif %}
                        <span class="nav-link username">Welcome, {{ user.username }}</span>
                        <a href="/logout" class="nav-link logout-button">Log Out</a>
                    {% else %}
                        <a href="/login" class="nav-link login-button">Log In</a>
                    {% endif %}
                </div>
            </nav>
            <div class="hero-section">
                <h1>Unlock Your Potential !</h1>
                <p>High-quality video courses to help you master new skills.</p>
            </div>
        </div>
    </header>
    <main class="container">
        <div class="video-grid">
            <!-- The loop variable is 'lesson', not 'video' -->
            {% for lesson in lessons %} 
                <!-- The video-card div wraps everything -->
                <div class="video-card">
                    <div class="thumbnail-container" onclick="showLanguageSelector('lesson-{{ lesson.id }}')">
                        <img class="thumbnail" src="https://res.cloudinary.com/df5edlmgq/video/upload/w_400,q_auto,f_auto/{{ lesson.videos[0].public_id if lesson.videos else '' }}.jpg" alt="Thumbnail for {{ lesson.title }}" loading="lazy">
                        <div class="play-icon-overlay">
                            <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="currentColor"><path d="M7 6v12l10-6z"></path></svg>
                        </div>
                    </div>
                    <div class="video-info">
                        <span class="video-category">{{ lesson.category }}</span>
                        <h3 class="video-title">{{ lesson.title }}</h3>
                        <p class="video-description">
                            Available in: 
                            {% for video in lesson.videos %}
                                {{ video.language }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </p>
                        <!-- Correctly placed Delete Form -->
                        {% if user.role == 'admin' %}
                        <div class="admin-actions">
                            <form action="/lesson/{{ lesson.id }}/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this lesson and all its videos?');">
                                <button type="submit" class="delete-button">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                    <!-- Hidden language selector for each lesson -->
                    <div id="lesson-{{ lesson.id }}" class="language-selector-popup" style="display:none;">
                        <div class="language-selector-content">
                            <h4>Select Language</h4>
                            {% for video in lesson.videos %}
                                <button onclick="playVideo('{{ video.video_url }}')">{{ video.language }}</button>
                            {% endfor %}
                            <button class="close-lang-selector" onclick="hideLanguageSelector('lesson-{{ lesson.id }}')">Close</button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </main>

    <div id="video-popup" class="popup">
        <span class="close-button" onclick="closePopup()">&times;</span>
        <div class="video-wrapper">
            <video id="player" controls autoplay></video>
        </div>
    </div>

    <!-- SCRIPT SECTION WITH DROPDOWN AND MENU JAVASCRIPT ADDED -->
    <script>
        const player = document.getElementById("player");
        const popup = document.getElementById("video-popup");
        const navbarLinks = document.querySelector(".navbar-links");

        function playVideo(filename) {
            // Hide language selectors before playing
            document.querySelectorAll('.language-selector-popup').forEach(p => p.style.display = 'none');
            
            if (filename.startsWith('http')) {
                player.src = filename;
            } else {
                player.src = `/video/${filename}`;
            }
            popup.style.display = "flex";
            document.body.style.overflow = 'hidden';
        }

        function closePopup() {
            popup.style.display = "none";
            player.pause();
            player.src = "";
            document.body.style.overflow = 'auto';
        }

        function showLanguageSelector(lessonId) {
            document.getElementById(lessonId).style.display = 'flex';
        }

        function hideLanguageSelector(lessonId) {
            document.getElementById(lessonId).style.display = 'none';
        }

        /* JAVASCRIPT FOR THE DROPDOWN */
        function toggleDropdown() {
            document.getElementById("language-dropdown").classList.toggle("show");
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
            if (!event.target.closest('.dropdown-btn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content");
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        /* JAVASCRIPT FOR THE MOBILE MENU */
        function toggleMenu() {
            navbarLinks.classList.toggle("active");
        }

        // Close the menu if the user clicks outside of it
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.navbar') && navbarLinks.classList.contains('active')) {
                navbarLinks.classList.remove('active');
            }
        });
    </script>
</body>
</html>